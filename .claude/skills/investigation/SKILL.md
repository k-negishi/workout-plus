---
name: investigation
description: 問題の原因分析・調査スキル。パフォーマンス問題、バグ、挙動不良などの報告に対して、推測で断定せず仮説→検証のプロセスで根本原因を特定する。「〜が遅い」「〜が動かない」「原因を調査して」といった依頼時に使用する。
allowed-tools: Read, Grep, Glob, Bash, Task, WebSearch
---

# 問題調査スキル

「遅い」「動かない」「おかしい」といった問題報告に対する調査手法。

---

## 原則: 推測で断定しない

- コードを読んだだけで「これが原因です」と断定しない
- **仮説を複数立て**（最低2つ）、裏付けを取ってから結論を出す
- 「以下が疑わしいので調査します」で始める。「原因はこれです」で始めない

### なぜ重要か

最初に目についた箇所を原因と断定すると、真の原因を見落とす。
表面的な症状（例: ローディングスピナーが一瞬出る）と根本原因（例: 親コンポーネントの不要な再レンダー）は別物であることが多い。

---

## 調査フロー

### Step 1: 症状の明確化

- ユーザーの報告を「何が」「いつ」「どの程度」に分解する
- 再現条件を特定する（特定の操作、特定のデータ量、特定のデバイス）

### Step 2: 仮説の列挙

問題の種類に応じて、以下の観点で仮説を複数立てる:

**パフォーマンス問題の場合:**

| 観点 | 確認すること |
|---|---|
| 再レンダー | `React.memo` の有無、`useMemo`/`useCallback` の依存配列の安定性 |
| サードパーティ | 重いコンポーネント（Calendar, Chart 等）の再レンダー頻度 |
| 非同期処理 | DB クエリのインデックス、ネットワーク遅延、直列 vs 並列 |
| DOM 操作 | `key` によるリマウント、リスト全体の再描画 |
| state 設計 | 不要な state 更新の連鎖、親→子の props 伝播範囲 |

**バグの場合:**

| 観点 | 確認すること |
|---|---|
| データフロー | 入力→変換→出力の各段階で期待値と実測値を照合 |
| 非同期タイミング | race condition、stale closure、useEffect の実行順序 |
| 境界条件 | null/undefined、空配列、0、空文字列、日付境界 |
| プラットフォーム差異 | iOS vs Android、Hermes vs JSC、Expo Go vs dev build |

### Step 3: 検証

- 仮説ごとに検証方法を決め、優先度順に実行する
- コードリーディング、ログ挿入、テスト実行、プロファイリングを使い分ける
- 1つの仮説が正しそうでも、他の仮説を完全に棄却してから結論を出す

### Step 4: 報告

```
## 調査結果

### 根本原因
[検証済みの原因を1つ明記]

### 根拠
[どの検証で確認したか]

### 副次的要因（あれば）
[根本原因ほどではないが影響している箇所]

### 除外した仮説
[調査したが原因ではなかったもの]
```

---

## アンチパターン

| やりがち | あるべき姿 |
|---|---|
| 最初に目についた箇所を「原因です」と断定 | 仮説を3つ挙げてから検証に入る |
| コードリーディングだけで結論 | 計測・ログ・テストで裏付けを取る |
| 1つの仮説が当たりそうだと他を検証しない | 全仮説を棄却または確認してから結論 |
| 修正案を先に出して原因説明が後回し | 原因→影響→修正案の順で説明 |
