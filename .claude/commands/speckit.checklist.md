---
description: 現在の機能に基づいてカスタムチェックリストを生成する。ユーザー要件に対応。
---

## チェックリストの目的: 「要件のユニットテスト」

**重要コンセプト**: チェックリストは**要件記述のユニットテスト**である — 特定のドメインにおける要件の品質、明確さ、完全性を検証する。

**検証/テスト用ではない**:

- ❌ "ボタンが正しくクリックできることを確認する" ではない
- ❌ "エラーハンドリングが動作することをテストする" ではない
- ❌ "APIが200を返すことを確認する" ではない
- ❌ コード/実装が仕様に合致しているか確認するものではない

**要件品質の検証用**:

- ✅ "全カードタイプについて視覚的階層の要件が定義されているか?"（完全性）
- ✅ "'目立つ表示'は具体的なサイズ/配置で定量化されているか?"（明確さ）
- ✅ "ホバー状態の要件は全インタラクティブ要素で一貫しているか?"（整合性）
- ✅ "キーボードナビゲーションのアクセシビリティ要件が定義されているか?"（カバレッジ）
- ✅ "ロゴ画像の読み込み失敗時の動作が仕様に定義されているか?"（エッジケース）

**比喩**: 仕様が英語（日本語）で書かれたコードだとすれば、チェックリストはそのユニットテストスイートである。要件が正しく書かれ、完全で、曖昧でなく、実装準備ができているかをテストする — 実装が動作するかをテストするのではない。

## ユーザー入力

```text
$ARGUMENTS
```

ユーザー入力が空でなければ、**必ず**内容を考慮してから進めること。

## 実行ステップ

1. **セットアップ**: リポジトリルートから `.specify/scripts/bash/check-prerequisites.sh --json` を実行し、JSONからFEATURE_DIRとAVAILABLE_DOCSリストを解析する。
   - 全ファイルパスは絶対パスであること。
   - 引数にシングルクォートを含む場合（例: "I'm Groot"）はエスケープ構文を使用: 例 'I'\''m Groot'（またはダブルクォート: "I'm Groot"）。

2. **意図の明確化（動的）**: 最大3つの初期コンテキスト確認質問を導出する（定型カタログなし）。質問は以下を満たすこと：
   - ユーザーの表現 + 仕様/計画/タスクから抽出したシグナルに基づいて生成
   - チェックリスト内容を実質的に変える情報についてのみ質問
   - `$ARGUMENTS` で既に明確な場合は個別にスキップ
   - 広さより精度を優先

   生成アルゴリズム：
   1. シグナルを抽出: 機能ドメインキーワード（例: 認証、レイテンシ、UX、API）、リスク指標（"重要"、"必須"、"コンプライアンス"）、ステークホルダーヒント（"QA"、"レビュー"、"セキュリティチーム"）、明示的な成果物（"a11y"、"ロールバック"、"コントラクト"）。
   2. シグナルを関連度順の候補フォーカスエリア（最大4）にクラスタリング。
   3. 可能性の高いオーディエンスとタイミング（著者、レビュアー、QA、リリース）を特定（明示されていない場合）。
   4. 欠落次元を検出: スコープの広さ、深さ/厳格さ、リスク重点、除外境界、測定可能な受け入れ基準。
   5. 以下のアーキタイプから質問を策定：
      - スコープの精緻化（例: "XとYとの統合タッチポイントを含めるべきか、ローカルモジュールの正確性に限定すべきか？"）
      - リスクの優先度付け（例: "これらの潜在的リスク領域のうち、どれが必須のゲーティングチェックを受けるべきか？"）
      - 深さの調整（例: "これは軽量なプレコミットサニティリストか、正式なリリースゲートか？"）
      - オーディエンスのフレーミング（例: "著者のみが使用するか、PRレビュー中の同僚も使用するか？"）
      - 境界の除外（例: "今回はパフォーマンスチューニング項目を明示的に除外すべきか？"）
      - シナリオクラスのギャップ（例: "リカバリーフローが検出されない — ロールバック/部分障害パスはスコープ内か？"）

   質問のフォーマットルール：
   - オプションを提示する場合、以下の列を持つコンパクトなテーブルを生成: オプション | 候補 | 重要な理由
   - 最大A-Eオプション。自由回答の方が明確な場合はテーブルを省略
   - ユーザーが既に述べたことの再確認を求めない
   - 投機的カテゴリを避ける（捏造なし）。不確かな場合は明示的に質問: "Xがスコープに含まれるか確認してください。"

   インタラクションが不可能な場合のデフォルト：
   - 深さ: 標準
   - オーディエンス: コード関連ならレビュアー（PR）、それ以外は著者
   - フォーカス: 関連度上位2クラスター

   質問を出力する（Q1/Q2/Q3とラベル付け）。回答後: 2つ以上のシナリオクラス（代替 / 例外 / リカバリー / 非機能ドメイン）がまだ不明確な場合、各1行の正当化付きで最大2つの追加フォローアップ質問（Q4/Q5）を出してもよい（例: "未解決のリカバリーパスリスク"）。合計5問を超えないこと。ユーザーが明示的にこれ以上の質問を辞退した場合はエスカレーションをスキップ。

3. **ユーザーリクエストの理解**: `$ARGUMENTS` + 確認回答を統合：
   - チェックリストテーマを導出（例: セキュリティ、レビュー、デプロイ、UX）
   - ユーザーが言及した明示的な必須項目を統合
   - フォーカス選択をカテゴリスキャフォールディングにマッピング
   - 仕様/計画/タスクから欠落コンテキストを推論（捏造しない）

4. **機能コンテキストの読み込み**: FEATURE_DIRから読み込み：
   - spec.md: 機能要件とスコープ
   - plan.md（存在する場合）: 技術詳細、依存関係
   - tasks.md（存在する場合）: 実装タスク

   **コンテキスト読み込み戦略**：
   - アクティブなフォーカスエリアに関連する必要な部分のみ読み込む（全ファイルダンプを避ける）
   - 長いセクションは簡潔なシナリオ/要件バレットに要約することを優先
   - 段階的開示: ギャップが検出された場合のみ追加取得
   - ソースドキュメントが大きい場合は、生テキストの埋め込みではなく中間サマリー項目を生成

5. **チェックリストを生成** - 「要件のユニットテスト」を作成：
   - `FEATURE_DIR/checklists/` ディレクトリが存在しない場合は作成
   - 一意のチェックリストファイル名を生成：
     - ドメインに基づく短く説明的な名前を使用（例: `ux.md`、`api.md`、`security.md`）
     - 形式: `[ドメイン].md`
     - ファイルが存在する場合は既存ファイルに追記
   - 項目はCHK001から連番
   - `/speckit.checklist` の各実行は**新しいファイル**を作成する（既存のチェックリストを上書きしない）

   **コア原則 - 実装ではなく要件をテストする**：
   全チェックリスト項目は、要件自体を以下の観点で評価すること：
   - **完全性**: 必要な要件が全て存在するか？
   - **明確さ**: 要件は曖昧でなく具体的か？
   - **整合性**: 要件は相互に整合しているか？
   - **測定可能性**: 要件は客観的に検証可能か？
   - **カバレッジ**: 全シナリオ/エッジケースが対応されているか？

   **カテゴリ構造** - 要件品質の次元ごとにグループ化：
   - **要件の完全性**（必要な要件が全て文書化されているか？）
   - **要件の明確さ**（要件は具体的で曖昧でないか？）
   - **要件の整合性**（要件間に矛盾はないか？）
   - **受け入れ基準の品質**（成功基準は測定可能か？）
   - **シナリオカバレッジ**（全フロー/ケースが対応されているか？）
   - **エッジケースカバレッジ**（境界条件が定義されているか？）
   - **非機能要件**（パフォーマンス、セキュリティ、アクセシビリティ等 — 仕様化されているか？）
   - **依存関係と前提条件**（文書化され検証されているか？）
   - **曖昧性と矛盾**（何を明確化する必要があるか？）

   **チェックリスト項目の書き方 - 「要件のユニットテスト」**：

   ❌ **誤り**（実装をテストしている）：
   - "ランディングページに3つのエピソードカードが表示されることを確認"
   - "デスクトップでホバー状態が動作することをテスト"
   - "ロゴクリックでホームに遷移することを確認"

   ✅ **正解**（要件品質をテストしている）：
   - "フィーチャーエピソードの正確な数とレイアウトが仕様化されているか?" [完全性]
   - "'目立つ表示'は具体的なサイズ/配置で定量化されているか?" [明確さ]
   - "ホバー状態の要件は全インタラクティブ要素で一貫しているか?" [整合性]
   - "全インタラクティブUIのキーボードナビゲーション要件が定義されているか?" [カバレッジ]
   - "ロゴ画像の読み込み失敗時のフォールバック動作が仕様に定義されているか?" [エッジケース]
   - "非同期エピソードデータの読み込み状態が定義されているか?" [完全性]
   - "競合するUI要素の視覚的階層が仕様に定義されているか?" [明確さ]

   **項目の構造**：
   各項目は以下のパターンに従うこと：
   - 要件品質について問う質問形式
   - 仕様/計画に**書かれていること**（または書かれていないこと）に焦点
   - 角括弧で品質次元を含む [完全性/明確さ/整合性/等]
   - 既存の要件を確認する場合は仕様セクション `[Spec §X.Y]` を参照
   - 欠落している要件を確認する場合は `[Gap]` マーカーを使用

   **品質次元ごとの例**：

   完全性：
   - "全API障害モードのエラーハンドリング要件が定義されているか? [Gap]"
   - "全インタラクティブ要素のアクセシビリティ要件が仕様化されているか? [完全性]"
   - "レスポンシブレイアウトのモバイルブレークポイント要件が定義されているか? [Gap]"

   明確さ：
   - "'高速読み込み'は具体的なタイミング閾値で定量化されているか? [明確さ, Spec §NFR-2]"
   - "'関連エピソード'の選択基準が明示的に定義されているか? [明確さ, Spec §FR-5]"
   - "'目立つ'は測定可能な視覚的プロパティで定義されているか? [曖昧性, Spec §FR-4]"

   整合性：
   - "ナビゲーション要件は全ページで整合しているか? [整合性, Spec §FR-10]"
   - "カードコンポーネントの要件はランディングページと詳細ページで一貫しているか? [整合性]"

   カバレッジ：
   - "ゼロ状態シナリオ（エピソードなし）の要件が定義されているか? [カバレッジ, エッジケース]"
   - "同時ユーザーインタラクションシナリオが対応されているか? [カバレッジ, Gap]"
   - "部分的なデータ読み込み失敗の要件が仕様化されているか? [カバレッジ, 例外フロー]"

   測定可能性：
   - "視覚的階層の要件は測定可能/テスト可能か? [受け入れ基準, Spec §FR-1]"
   - "'バランスの取れた視覚的重み'は客観的に検証可能か? [測定可能性, Spec §FR-2]"

   **シナリオ分類とカバレッジ**（要件品質にフォーカス）：
   - 以下の要件が存在するか確認: プライマリ、代替、例外/エラー、リカバリー、非機能シナリオ
   - 各シナリオクラスについて問う: "[シナリオタイプ]の要件は完全、明確、整合しているか？"
   - シナリオクラスが欠落している場合: "[シナリオタイプ]の要件は意図的に除外されているか、それとも欠落しているか? [Gap]"
   - 状態変更が発生する場合のレジリエンス/ロールバックを含む: "マイグレーション失敗時のロールバック要件が定義されているか? [Gap]"

   **トレーサビリティ要件**：
   - 最低条件: 項目の80%以上に少なくとも1つのトレーサビリティ参照を含む
   - 各項目は参照すべき: 仕様セクション `[Spec §X.Y]`、またはマーカーを使用: `[Gap]`、`[曖昧性]`、`[矛盾]`、`[前提]`
   - ID体系がない場合: "要件と受け入れ基準のID体系が確立されているか? [トレーサビリティ]"

   **問題の検出と解決**（要件品質の問題）：
   要件自体について質問する：
   - 曖昧性: "'高速'は具体的なメトリクスで定量化されているか? [曖昧性, Spec §NFR-1]"
   - 矛盾: "§FR-10と§FR-10aのナビゲーション要件は矛盾していないか? [矛盾]"
   - 前提: "'常に利用可能なポッドキャストAPI'の前提は検証されているか? [前提]"
   - 依存関係: "外部ポッドキャストAPIの要件が文書化されているか? [依存関係, Gap]"
   - 定義の欠落: "'視覚的階層'は測定可能な基準で定義されているか? [Gap]"

   **コンテンツの統合**：
   - ソフトキャップ: 生の候補項目が40を超える場合はリスク/影響度で優先度付け
   - 同じ要件側面を確認する重複に近い項目を統合
   - 低影響のエッジケースが5つ以上ある場合は1項目にまとめる: "エッジケースX、Y、Zが要件で対応されているか? [カバレッジ]"

   **絶対禁止** — これらは実装テストであり要件テストではない：
   - ❌ "検証する"、"テストする"、"確認する" + 実装動作で始まる項目
   - ❌ コード実行、ユーザーアクション、システム動作への参照
   - ❌ "正しく表示される"、"適切に動作する"、"期待通りに機能する"
   - ❌ "クリック"、"遷移"、"レンダリング"、"読み込み"、"実行"
   - ❌ テストケース、テスト計画、QA手順
   - ❌ 実装詳細（フレームワーク、API、アルゴリズム）

   **必須パターン** — これらは要件品質をテストする：
   - ✅ "[要件タイプ]は[シナリオ]について定義/仕様化/文書化されているか?"
   - ✅ "[曖昧な用語]は具体的な基準で定量化/明確化されているか?"
   - ✅ "[セクションA]と[セクションB]の要件は整合しているか?"
   - ✅ "[要件]は客観的に測定/検証可能か?"
   - ✅ "[エッジケース/シナリオ]が要件で対応されているか?"
   - ✅ "仕様に[欠落している側面]が定義されているか?"

6. **構造の参照**: `.specify/templates/checklist-template.md` の正規テンプレートに従ってチェックリストを生成する（タイトル、メタセクション、カテゴリ見出し、IDフォーマット）。テンプレートが利用できない場合は: H1タイトル、目的/作成日メタ行、`##` カテゴリセクションにCHK001からグローバルインクリメントIDの `- [ ] CHK### <要件項目>` 行を含める。

7. **レポート**: 作成されたチェックリストのフルパス、項目数を出力し、各実行が新しいファイルを作成することをリマインド。以下を要約：
   - 選択されたフォーカスエリア
   - 深さレベル
   - アクター/タイミング
   - ユーザーが明示的に指定した必須項目が反映されているか

**重要**: `/speckit.checklist` コマンドの各実行は、ファイルが既に存在しない限り、短く説明的な名前でチェックリストファイルを作成する。これにより：

- 異なるタイプの複数チェックリスト（例: `ux.md`、`test.md`、`security.md`）
- 目的を示すシンプルで覚えやすいファイル名
- `checklists/` フォルダでの簡単な識別とナビゲーション

散乱を避けるため、説明的なタイプを使用し、完了後に不要なチェックリストを整理すること。

## チェックリストタイプの例とサンプル項目

**UX要件品質:** `ux.md`

サンプル項目（実装ではなく要件をテスト）：

- "視覚的階層の要件は測定可能な基準で定義されているか? [明確さ, Spec §FR-1]"
- "UI要素の数と配置が明示的に仕様化されているか? [完全性, Spec §FR-1]"
- "インタラクション状態の要件（ホバー、フォーカス、アクティブ）が一貫して定義されているか? [整合性]"
- "全インタラクティブ要素のアクセシビリティ要件が仕様化されているか? [カバレッジ, Gap]"
- "画像読み込み失敗時のフォールバック動作が定義されているか? [エッジケース, Gap]"
- "'目立つ表示'は客観的に測定可能か? [測定可能性, Spec §FR-4]"

**API要件品質:** `api.md`

サンプル項目：

- "全障害シナリオのエラーレスポンス形式が仕様化されているか? [完全性]"
- "レート制限要件が具体的な閾値で定量化されているか? [明確さ]"
- "認証要件は全エンドポイントで一貫しているか? [整合性]"
- "外部依存関係のリトライ/タイムアウト要件が定義されているか? [カバレッジ, Gap]"
- "バージョニング戦略が要件に文書化されているか? [Gap]"

**パフォーマンス要件品質:** `performance.md`

サンプル項目：

- "パフォーマンス要件が具体的なメトリクスで定量化されているか? [明確さ]"
- "全重要ユーザージャーニーのパフォーマンス目標が定義されているか? [カバレッジ]"
- "異なる負荷条件でのパフォーマンス要件が仕様化されているか? [完全性]"
- "パフォーマンス要件は客観的に測定可能か? [測定可能性]"
- "高負荷シナリオの劣化要件が定義されているか? [エッジケース, Gap]"

**セキュリティ要件品質:** `security.md`

サンプル項目：

- "全保護リソースの認証要件が仕様化されているか? [カバレッジ]"
- "機密情報のデータ保護要件が定義されているか? [完全性]"
- "脅威モデルが文書化され要件が整合しているか? [トレーサビリティ]"
- "セキュリティ要件はコンプライアンス義務と整合しているか? [整合性]"
- "セキュリティ障害/侵害対応の要件が定義されているか? [Gap, 例外フロー]"

## アンチパターン: やってはいけないこと

**❌ 誤り - 実装をテストしている:**

```markdown
- [ ] CHK001 - ランディングページに3つのエピソードカードが表示されることを確認 [Spec §FR-001]
- [ ] CHK002 - デスクトップでホバー状態が正しく動作することをテスト [Spec §FR-003]
- [ ] CHK003 - ロゴクリックでホームページに遷移することを確認 [Spec §FR-010]
- [ ] CHK004 - 関連エピソードセクションに3-5個の項目が表示されることをチェック [Spec §FR-005]
```

**✅ 正解 - 要件品質をテストしている:**

```markdown
- [ ] CHK001 - フィーチャーエピソードの数とレイアウトが明示的に仕様化されているか? [完全性, Spec §FR-001]
- [ ] CHK002 - ホバー状態の要件は全インタラクティブ要素で一貫して定義されているか? [整合性, Spec §FR-003]
- [ ] CHK003 - クリック可能なブランド要素のナビゲーション要件は明確か? [明確さ, Spec §FR-010]
- [ ] CHK004 - 関連エピソードの選択基準が文書化されているか? [Gap, Spec §FR-005]
- [ ] CHK005 - 非同期エピソードデータの読み込み状態要件が定義されているか? [Gap]
- [ ] CHK006 - "視覚的階層"の要件は客観的に測定可能か? [測定可能性, Spec §FR-001]
```

**主な違い:**

- 誤り: システムが正しく動作するかをテスト
- 正解: 要件が正しく書かれているかをテスト
- 誤り: 動作の検証
- 正解: 要件品質の妥当性確認
- 誤り: "Xは動作するか？"
- 正解: "Xは明確に仕様化されているか？"
