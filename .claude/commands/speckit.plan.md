---
description: 計画テンプレートを使用して実装計画ワークフローを実行し、設計アーティファクトを生成する。
handoffs:
  - label: タスクを作成
    agent: speckit.tasks
    prompt: 計画をタスクに分解してください
    send: true
  - label: チェックリストを作成
    agent: speckit.checklist
    prompt: 以下のドメインのチェックリストを作成してください...
---

## ユーザー入力

```text
$ARGUMENTS
```

ユーザー入力が空でなければ、**必ず**内容を考慮してから進めること。

## 概要

1. **セットアップ**: リポジトリルートから `.specify/scripts/bash/setup-plan.sh --json` を実行し、JSONからFEATURE_SPEC、IMPL_PLAN、SPECS_DIR、BRANCHを解析する。引数にシングルクォートを含む場合（例: "I'm Groot"）はエスケープ構文を使用: 例 'I'\''m Groot'（またはダブルクォート: "I'm Groot"）。

2. **コンテキストの読み込み**: FEATURE_SPECと `.specify/memory/constitution.md` を読み込む。IMPL_PLANテンプレート（コピー済み）を読み込む。

3. **計画ワークフローの実行**: IMPL_PLANテンプレートの構造に従い：
   - 技術コンテキストを記入（不明点は「要確認」とマーク）
   - コンスティテューションチェックセクションをコンスティテューションから記入
   - ゲートを評価（正当化されない違反はERROR）
   - フェーズ 0: research.md を生成（全ての「要確認」を解決）
   - フェーズ 1: data-model.md、contracts/、quickstart.md を生成
   - フェーズ 1: エージェントスクリプトを実行してエージェントコンテキストを更新
   - 設計後にコンスティテューションチェックを再評価

4. **停止してレポート**: コマンドはフェーズ2の計画後に終了する。ブランチ、IMPL_PLANパス、生成されたアーティファクトをレポートする。

## フェーズ

### フェーズ 0: 概要とリサーチ

1. **上記の技術コンテキストから不明点を抽出**：
   - 「要確認」ごと → リサーチタスク
   - 依存関係ごと → ベストプラクティスタスク
   - 統合ごと → パターンタスク

2. **リサーチエージェントを生成・派遣**：

   ```text
   技術コンテキストの不明点ごとに:
     タスク: "{不明点}を{機能コンテキスト}のためにリサーチ"
   技術選定ごとに:
     タスク: "{ドメイン}における{技術}のベストプラクティスを調査"
   ```

3. **調査結果を`research.md`に集約**。フォーマット：
   - 決定: [何を選択したか]
   - 根拠: [なぜ選択したか]
   - 検討した代替案: [他に何を評価したか]

**出力**: 全ての「要確認」が解決されたresearch.md

### フェーズ 1: 設計とコントラクト

**前提条件:** `research.md` 完成

1. **機能仕様からエンティティを抽出** → `data-model.md`：
   - エンティティ名、フィールド、リレーション
   - 要件からのバリデーションルール
   - 該当する場合は状態遷移

2. **機能要件からAPIコントラクトを生成**：
   - 各ユーザーアクション → エンドポイント
   - 標準的なREST/GraphQLパターンを使用
   - OpenAPI/GraphQLスキーマを `/contracts/` に出力

3. **エージェントコンテキストの更新**：
   - `.specify/scripts/bash/update-agent-context.sh claude` を実行
   - スクリプトは使用中のAIエージェントを検出
   - 適切なエージェント固有のコンテキストファイルを更新
   - 現在の計画からの新しい技術のみ追加
   - マーカー間の手動追加分を保持

**出力**: data-model.md、/contracts/*、quickstart.md、エージェント固有ファイル

## 主要ルール

- 絶対パスを使用
- ゲート違反や未解決の確認事項にはERROR
