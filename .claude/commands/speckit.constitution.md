---
description: インタラクティブまたは提供された原則入力からプロジェクトコンスティテューションを作成・更新し、依存するすべてのテンプレートとの同期を確保する。
handoffs:
  - label: 仕様書を作成
    agent: speckit.specify
    prompt: 更新されたコンスティテューションに基づいて機能仕様を作成してください。構築したいものは...
---

## ユーザー入力

```text
$ARGUMENTS
```

ユーザー入力が空でなければ、**必ず**内容を考慮してから進めること。

## 概要

`.specify/memory/constitution.md` にあるプロジェクトコンスティテューションを更新する。このファイルは角括弧でプレースホルダートークン（例: `[PROJECT_NAME]`、`[PRINCIPLE_1_NAME]`）を含むテンプレートである。あなたの仕事は (a) 具体的な値を収集/導出し、(b) テンプレートを正確に埋め、(c) 変更を依存アーティファクト全体に伝播すること。

**注意**: `.specify/memory/constitution.md` がまだ存在しない場合、プロジェクトセットアップ時に `.specify/templates/constitution-template.md` から初期化されているはずである。欠落している場合はまずテンプレートをコピーすること。

以下の実行フローに従う：

1. `.specify/memory/constitution.md` にある既存のコンスティテューションを読み込む。
   - `[ALL_CAPS_IDENTIFIER]` 形式のすべてのプレースホルダートークンを特定する。
   **重要**: ユーザーはテンプレートの原則数より多い場合も少ない場合もある。数が指定された場合はそれを尊重する — 一般的なテンプレートに従う。ドキュメントをそれに応じて更新する。

2. プレースホルダーの値を収集/導出する：
   - ユーザー入力（会話）が値を提供している場合はそれを使用。
   - それ以外は既存のリポジトリコンテキスト（README、ドキュメント、以前のコンスティテューションバージョン等）から推論。
   - ガバナンス日付: `RATIFICATION_DATE` は最初の採択日（不明な場合は確認するかTODOとマーク）、`LAST_AMENDED_DATE` は変更がある場合は本日、そうでなければ前回を保持。
   - `CONSTITUTION_VERSION` はセマンティックバージョニングルールに従ってインクリメント：
     - MAJOR: 後方互換性のないガバナンス/原則の削除または再定義。
     - MINOR: 新しい原則/セクションの追加、またはガイダンスの実質的な拡張。
     - PATCH: 明確化、表現修正、タイポ修正、非セマンティックな改善。
   - バージョンバンプの種類が曖昧な場合は、確定前に根拠を提示する。

3. 更新されたコンスティテューション内容を起草する：
   - すべてのプレースホルダーを具体的なテキストに置換（プロジェクトが意図的に未定義のまま残すテンプレートスロット以外、角括弧トークンは残さない — 残す場合は明示的に正当化する）。
   - 見出し階層を保持し、置換後に不要なコメントは削除（ただし補足ガイダンスとして有用な場合は残す）。
   - 各原則セクション: 簡潔な名前行、交渉不可のルールを記載した段落（またはリスト）、自明でない場合は明示的な根拠。
   - ガバナンスセクション: 修正手続き、バージョニングポリシー、コンプライアンスレビュー期待値を記載。

4. 整合性伝播チェックリスト（以前のチェックリストをアクティブな検証に変換）：
   - `.specify/templates/plan-template.md` を読み、「コンスティテューションチェック」やルールが更新された原則と整合しているか確認。
   - `.specify/templates/spec-template.md` のスコープ/要件の整合性を確認 — コンスティテューションが必須セクションや制約を追加/削除した場合は更新。
   - `.specify/templates/tasks-template.md` のタスク分類が新しい/削除された原則駆動のタスクタイプ（例: 可観測性、バージョニング、テスト規律）を反映しているか確認。
   - `.specify/templates/commands/*.md` の各コマンドファイルを読み、汎用ガイダンスが必要な場合に古い参照（CLAUDE固有のエージェント名等）が残っていないか確認。
   - ランタイムガイダンスドキュメント（例: `README.md`、`docs/quickstart.md`、エージェント固有のガイダンスファイル）を読み、変更された原則への参照を更新。

5. 同期影響レポートを作成する（更新後にコンスティテューションファイルの先頭にHTMLコメントとして挿入）：
   - バージョン変更: 旧 → 新
   - 変更された原則のリスト（名前変更された場合は 旧タイトル → 新タイトル）
   - 追加されたセクション
   - 削除されたセクション
   - 更新が必要なテンプレート（✅ 更新済 / ⚠ 保留中）とファイルパス
   - プレースホルダーを意図的に保留した場合のフォローアップTODO

6. 最終出力前の検証：
   - 説明なしの角括弧トークンが残っていないこと。
   - バージョン行がレポートと一致すること。
   - 日付がISO形式 YYYY-MM-DD であること。
   - 原則が宣言的、テスト可能であり、曖昧な表現がないこと（"should" → 適切な場合はMUST/SHOULDと根拠に置換）。

7. 完成したコンスティテューションを `.specify/memory/constitution.md` に書き戻す（上書き）。

8. ユーザーへの最終サマリーを出力：
   - 新バージョンとバンプの根拠。
   - 手動フォローアップが必要なファイル。
   - 推奨コミットメッセージ（例: `docs: コンスティテューションをvX.Y.Zに修正（原則追加 + ガバナンス更新）`）。

フォーマット・スタイル要件：

- テンプレートと同じMarkdown見出しを使用（レベルの昇格/降格をしない）。
- 長い根拠文は可読性のために折り返す（理想は100文字未満）が、不自然な改行は避ける。
- セクション間に空行を1行入れる。
- 末尾の空白を避ける。

ユーザーが部分的な更新（例: 1つの原則の修正のみ）を提供した場合でも、検証とバージョン判定ステップは実行する。

重要な情報が欠落している場合（例: 承認日が本当に不明）は `TODO(<FIELD_NAME>): 説明` を挿入し、同期影響レポートの保留項目に含める。

新しいテンプレートを作成しないこと。常に既存の `.specify/memory/constitution.md` ファイルを操作すること。
