# Feature Specification: カレンダー日付選択・表示修正

**Feature Branch**: `20260222-カレンダー日付選択-表示修正`
**Created**: 2026-02-22
**Status**: Draft
**Input**: GitHub Issue #108 - カレンダーで特定の日付を押下しても、その日付の情報が表示されない。当日のまま。デザインも崩れている。

## User Scenarios & Testing *(mandatory)*

### User Story 1 - カレンダーで日付をタップして選択日の情報を確認する (Priority: P1)

ユーザーがカレンダー画面で過去の任意の日付をタップすると、その日のワークアウトサマリー（所要時間・種目数・セット数・総ボリューム）が画面下部に表示される。現在は日付をタップしても当日の情報が表示され続けるバグがある。

**Why this priority**: アプリのカレンダー機能の根幹となるインタラクションであり、この動作が壊れていると機能全体が無価値になる。

**Independent Test**: カレンダー画面を開き、任意の過去日付をタップして「その日付のワークアウト情報」が下部に表示されることを確認する。

**Acceptance Scenarios**:

1. **Given** カレンダー画面が当日を表示した状態で、**When** ユーザーが今日以前の日付（例：昨日）をタップすると、**Then** 下部サマリーエリアがその選択日のワークアウト情報に更新される
2. **Given** トレーニング記録のある過去日がカレンダー上に表示されている状態で、**When** ユーザーがその日付をタップすると、**Then** 所要時間・種目数・セット数・総ボリュームが正しく表示される
3. **Given** トレーニング記録のない過去日をタップしたとき、**When** DaySummaryを確認すると、**Then** 「この日はトレーニングなし」と表示される
4. **Given** 選択済みの日付がある状態で、**When** 別の日付をタップすると、**Then** 選択状態（ハイライト）が新しい日付に移り、サマリーも更新される

---

### User Story 2 - 今日の日付の選択制約が正しく機能する (Priority: P2)

未来日のタップは無効とし、今日以前の日付のみタップ可能であることを正しく動作させる。

**Why this priority**: 存在しない将来のワークアウトデータへのアクセスを防ぐ。バグ修正で条件ロジックが正しくなることで解決される。

**Independent Test**: カレンダー上で翌日以降の日付をタップしても選択状態が変わらないことを確認する。

**Acceptance Scenarios**:

1. **Given** カレンダーに翌日以降の日付が表示されている状態で、**When** ユーザーが未来日をタップすると、**Then** 選択日は変わらず、サマリーは更新されない
2. **Given** 今日の日付が表示されている状態で、**When** 今日の日付をタップすると、**Then** 今日が選択状態となりサマリーが表示される

---

### User Story 3 - カレンダー画面のデザインが正しく表示される (Priority: P3)

カレンダー画面のレイアウトやUIコンポーネントが崩れることなく、デザイン方針（メインカラー #4D94FF、グレー文字 #475569）に沿って正常に描画される。

**Why this priority**: バグ修正と同時に対応すべきUIの品質問題だが、機能的には日付選択が最優先。

**Independent Test**: カレンダー画面をiOSシミュレーターで開き、カレンダーグリッド・ヘッダー・サマリーカードが崩れなく表示されることを目視確認する。

**Acceptance Scenarios**:

1. **Given** カレンダー画面を開いたとき、**When** 画面を確認すると、**Then** カレンダーグリッド・ヘッダー・サマリーが重なりや欠けなく表示される
2. **Given** 日付を選択したとき、**When** 選択日のハイライトを確認すると、**Then** 選択日が #4D94FF の背景色で白文字で表示され、他の日付と視覚的に区別できる

---

### Edge Cases

- ワークアウトデータが1件も存在しない（新規ユーザー）状態でカレンダーを開いた場合、全日付で「この日はトレーニングなし」が表示される
- 月をまたいで別月に移動後に日付タップしても選択・表示が正しく機能する
- 今日が月初（1日）の場合、前月からのカレンダー表示で過去日タップが正常に動作する
- タイムゾーンの影響で日付の境界がズレないこと（特に `new Date('yyyy-MM-dd')` のUTC解釈問題）

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: カレンダー上の今日以前の日付をタップすると、選択状態がその日付に移り、下部サマリーがその日のデータで更新されなければならない
- **FR-002**: カレンダー上の未来日をタップしても、選択状態・サマリーが変化してはならない
- **FR-003**: 選択日のワークアウトデータが存在する場合、所要時間・種目数・セット数・総ボリュームを正しく表示しなければならない
- **FR-004**: 選択日のワークアウトデータが存在しない場合、「この日はトレーニングなし」を表示しなければならない
- **FR-005**: カレンダー画面の各UIコンポーネント（カレンダーグリッド、ヘッダー、サマリーカード）がデザイン方針に沿って崩れなく表示されなければならない
- **FR-006**: 日付の判定においてタイムゾーンの影響を受けず、ユーザーのローカル日付で正しく動作しなければならない

### Key Entities

- **選択日 (selectedDate)**: カレンダー上でハイライト表示される日付。ユーザーのタップにより変更され、DaySummaryの表示内容を決定する
- **ワークアウト (Workout)**: 完了済みのトレーニングセッション。日付・所要時間・種目・セットの集合体

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: カレンダー上の任意の過去日付をタップしてから1秒以内に、対応する日付のサマリーが表示される
- **SC-002**: 日付タップ→サマリー更新のインタラクションが100%成功する（今日以前の全日付で動作する）
- **SC-003**: 未来日をタップしても画面の状態が変化しない（0%の誤作動）
- **SC-004**: カレンダー画面を開いた際にUIの崩れ（コンポーネントの欠け・重なり）が発生しない
