# 機能仕様書: ワイヤーフレーム準拠 UI 実装

**フィーチャーブランチ**: `main`
**作成日**: 2026-02-21
**ステータス**: Draft
**入力**: MVPスクリーン全画面をワイヤーフレーム HTML (`requirements/adopted/workout_plus_wireframes_v5_md3.html`) のデザインに準拠させる

---

## 背景と目的

ユーザーがアプリを実機で触って検証するために、ワイヤーフレームで定義したビジュアルデザインと現在の実装の差異を解消する必要がある。現在の実装は機能面はほぼ完成しているが、ワイヤーフレームとの視覚的差異が複数存在する。これらを修正し、ユーザー検証に耐えられる状態にする。

**対象範囲**: MVP スコープとして定義した以下の 8 画面 + タブバー
- ホーム画面
- 記録画面（ワークアウトセッション）
- 種目選択画面（ExercisePicker）
- 種目履歴画面（ExerciseHistory）
- ワークアウト完了サマリー画面
- カレンダー画面
- ワークアウト詳細画面
- 統計画面（プレースホルダー「準備中」表示のみ、AI タブと同様の扱い）

---

## ユーザーシナリオ & テスト *(必須)*

### ユーザーストーリー 1 — タブバーが正しく表示される (優先度: P1)

ユーザーがアプリを開いたとき、タブバーに 5 つのタブが正しく表示され、中央の + ボタンがタブバーから浮き出た状態で視覚的にクリアに見える。

**この優先度の理由**: タブバーはすべての画面から常時見える要素。ここが壊れているとアプリ全体の信頼性が損なわれる。

**独立テスト**: アプリを起動してホーム画面を確認するだけで検証可能。

**受け入れシナリオ**:

1. **Given** アプリが起動している、**When** ホーム画面を表示する、**Then** タブバーに「ホーム」「カレンダー」「+（記録）」「統計」「AI」の 5 つのタブが表示される
2. **Given** タブバーが表示されている、**When** 中央の + ボタンを確認する、**Then** ボタン(56×56px)がタブバーより 24px 上に浮き出て完全に表示されている（切れていない）
3. **Given** ホームタブがアクティブ、**When** 各タブアイテムを確認する、**Then** アクティブタブは #4D94FF（青）、非アクティブタブは #64748b（グレー）で表示される
4. **Given** 別のタブをタップする、**When** タブが切り替わる、**Then** アクティブタブのアイコンが太くなり（stroke-width 2.5）ラベルが太字（font-weight 700）になる

---

### ユーザーストーリー 2 — 各画面がノッチ・ホームバーと重ならない (優先度: P1)

ユーザーが各画面を表示したとき、コンテンツがデバイスのノッチ・ダイナミックアイランド・ホームインジケーターと重ならず、安全領域内に正しく表示される。

**この優先度の理由**: SafeArea 未適用はデバイスによってコンテンツが隠れる致命的な表示バグ。

**独立テスト**: 実機または Expo Go で各画面を開いてノッチとの重なりを目視確認。

**受け入れシナリオ**:

1. **Given** ホーム画面を表示する、**When** 画面上部を確認する、**Then** ヘッダーのグリーティングテキストがノッチ・ステータスバーと重ならない
2. **Given** カレンダー画面を表示する、**When** 画面上部を確認する、**Then** 月タイトルと矢印ボタンがステータスバーと重ならない
3. **Given** 記録画面を表示する、**When** 画面上部を確認する、**Then** タイマーバーがステータスバーと重ならない
4. **Given** 任意の画面を表示する、**When** 画面下部を確認する、**Then** コンテンツがホームインジケーター（iPhone）と重ならない

---

### ユーザーストーリー 3 — ホーム画面がワイヤーフレームのレイアウトで表示される (優先度: P2)

ユーザーがホームタブを開いたとき、ワイヤーフレームで定義した「今週の目標」グリッドと「最近のトレーニング」と「ダッシュボード」の 3 セクション構成が正しく表示される。

**この優先度の理由**: ホームはアプリの顔。ワイヤーフレームとの乖離はユーザーの第一印象を損なう。

**独立テスト**: ダミーデータでもホーム画面を開けば確認可能。

**受け入れシナリオ**:

1. **Given** ホーム画面を表示する、**When** ヘッダーを確認する、**Then** 時間帯別挨拶テキスト + 右端にユーザーアバター（イニシャル円形）が表示される
2. **Given** ホーム画面を表示する、**When** StreakCard を確認する、**Then** 今月のトレーニング日数（数値大きく）+ 炎アイコン + 直近 7 日の塗りつぶし小円インジケーター（完了: #4D94FF・休息: #e2e8f0、曜日ラベルなし）が表示される
3. **Given** ワークアウトが 1 件以上ある、**When** 「最近のトレーニング」セクションを確認する、**Then** 各ワークアウトカードに「種目数・セット数・総ボリューム・時間」のタグが表示される
4. **Given** ホーム画面を表示する、**When** ダッシュボードウィジェットを確認する、**Then** 4 つの統計カード（月間ワークアウト数・週間・月間ボリューム・最長ストリーク）が 2×2 グリッドで表示される

---

### ユーザーストーリー 4 — 記録画面がワイヤーフレームのレイアウトで表示される (優先度: P2)

ユーザーがワークアウトを記録するとき、ワイヤーフレームで定義したセット入力レイアウト（前回記録インライン表示、1RM 自動計算）が正しく表示・動作する。

**この優先度の理由**: 記録画面はアプリのコア機能。細部のデザイン精度が操作性に直結する。

**独立テスト**: + ボタンを押して記録画面を開き、種目を追加してセット入力エリアを確認。

**受け入れシナリオ**:

1. **Given** ワークアウト記録中、**When** セット入力エリアを確認する、**Then** 各セット行の上に「前回: 55.5kg × 4」形式でグレーテキストが表示される
2. **Given** 重量と回数を入力する、**When** 両方が入力されている、**Then** セット行末尾に推定 1RM 値がグレーで自動計算・表示される
3. **Given** 記録画面の上部タイマーバーを確認する、**When** ワークアウト中、**Then** 経過時間・再生/停止ボタン・完了ボタンが固定ヘッダーとして表示される

---

### ユーザーストーリー 5 — カレンダー・詳細画面がワイヤーフレームのレイアウトで表示される (優先度: P2)

ユーザーがカレンダーで日付を選択したとき、その日のワークアウト詳細（サマリー統計 + 種目別セットリスト）が正しく表示される。

**受け入れシナリオ**:

1. **Given** カレンダー画面を表示する、**When** トレーニングのある日付を確認する、**Then** 日付セルに小さな青い点インジケーターが表示される
2. **Given** カレンダーの日付を選択する、**When** ワークアウトがある日、**Then** 下部に「所要時間・総ボリューム・種目数・セット数」の 4 項目サマリーが表示される
3. **Given** ワークアウト詳細画面を表示する、**When** セットリストを確認する、**Then** 各セット行にチェックマーク（緑）+ セット番号 + 「80kg × 10」形式 + 推定 1RM が表示される

---

### ユーザーストーリー 6 — ワークアウト完了サマリーがワイヤーフレームのレイアウトで表示される (優先度: P2)

ユーザーがワークアウトを完了したとき、完了サマリー画面にストリーク継続バナーと達成 PR 一覧が表示される。

**受け入れシナリオ**:

1. **Given** ワークアウト完了後、**When** サマリー画面を確認する、**Then** 大きなチェックマーク円 + 「ワークアウト完了」タイトルが表示される
2. **Given** ストリークが継続している、**When** サマリー画面を確認する、**Then** プライマリブルー背景の「N日連続!」ストリークカードが表示される
3. **Given** PR を更新した種目がある、**When** サマリー画面を確認する、**Then** 「新記録達成」セクションに種目名と「NEW」バッジが表示される

---

### ユーザーストーリー 7 — 種目選択画面がワイヤーフレームのレイアウトで表示される (優先度: P2)

ユーザーが記録中に種目を追加するとき、フルスクリーンモーダルで種目一覧が表示され、テキスト検索で絞り込める。

**受け入れシナリオ**:

1. **Given** 記録画面で種目追加ボタンをタップする、**When** 種目選択画面が開く、**Then** フルスクリーンモーダルで種目一覧が表示される
2. **Given** 種目選択画面を表示する、**When** 検索バーにテキストを入力する、**Then** 入力文字にマッチする種目にリアルタイムフィルタリングされる（カテゴリフィルターは含まない）
3. **Given** 種目を選択する、**When** 種目をタップする、**Then** モーダルが閉じて選択した種目が記録画面に追加される

---

### ユーザーストーリー 8 — 種目履歴画面がワイヤーフレームのレイアウトで表示される (優先度: P2)

ユーザーが種目履歴を確認するとき、フルスクリーンで過去の記録一覧が表示される。

**受け入れシナリオ**:

1. **Given** 記録画面またはワークアウト詳細画面で種目名をタップする、**When** 種目履歴画面が開く、**Then** フルスクリーンで過去の記録一覧が表示される

---

### エッジケース

- ワークアウトが 0 件のとき、ホーム画面は EmptyState（+ボタン誘導テキスト）を表示する
- 選択した日付にワークアウトがないとき、カレンダー詳細セクションは「この日はトレーニングなし」を表示する
- ノッチのないデバイス（Android、古い iPhone）でも SafeArea が正しく動作する（余白が増えるだけで崩れない）
- 記録画面で種目がまだ追加されていないとき、「+ 種目を追加」誘導テキスト＋ボタンを中央に表示する
- ExercisePicker で検索結果が 0 件のとき、「該当する種目が見つかりません」テキストを中央に表示する
- ワークアウト完了サマリーで PR 達成種目が 0 件のとき、「新記録達成」セクション自体を非表示にする

---

## 要件 *(必須)*

### 機能要件

**タブバー**

- **FR-001**: タブバーは「ホーム」「カレンダー」「+（記録）」「統計」「AI」の 5 タブを表示しなければならない
- **FR-002**: 中央の + ボタン（56×56px・円形）はタブバーより 24px 上に飛び出した状態で完全に表示されなければならない（overflow clipping 禁止）
- **FR-003**: アクティブタブはアイコンの stroke が太く（2.5）、ラベルが太字（700）でなければならない
- **FR-004**: AI タブは現時点でプレースホルダー画面（「準備中」表示）でよい

**SafeArea 対応**

- **FR-005**: 全スクリーンのヘッダーはデバイスのステータスバー・ノッチ領域を侵食してはならない
- **FR-006**: 全スクリーンの下部コンテンツはホームインジケーター領域と重なってはならない
- **FR-007**: SafeAreaView または useSafeAreaInsets を使用して動的に安全領域を取得すること（通常画面・フルスクリーンモーダル・フルスクリーン遷移画面すべてに適用）

**ホーム画面**

- **FR-008**: StreakCard は今月のトレーニング日数（大きな数値）と直近 7 日間の各日を塗りつぶし小円（完了: #4D94FF・28×28px、休息: #e2e8f0・28×28px）で表示しなければならない（曜日ラベルなし）
- **FR-009**: 最近のトレーニングカードは「種目数」「セット数」「総ボリューム（kg）」「経過時間」のタグを表示しなければならない
- **FR-010**: ダッシュボードウィジェットは 4 統計を 2×2 グリッドで表示しなければならない

**記録画面**

- **FR-011**: 各セット入力行の上に前回の記録（重量 × 回数）をグレーテキストでインライン表示しなければならない
- **FR-012**: 重量と回数が両方入力されたとき、推定 1RM（エペリー式）をリアルタイムで計算・表示しなければならない
- **FR-013**: タイマーバーは画面上部に固定表示され、スクロールしても追従しなければならない

**カレンダー画面**

- **FR-014**: トレーニングのある日付セルは小さな青い点インジケーターを表示しなければならない
- **FR-015**: 日付選択時、下部エリアにサマリー統計（4 項目）と種目別セットリストを表示しなければならない

**ワークアウト詳細画面**

- **FR-016**: セット行はチェックマーク（緑）+ セット番号 + 「重量 × 回数」+ 推定 1RM の形式で表示しなければならない

**ワークアウト完了サマリー**

- **FR-017**: ストリーク継続日数をプライマリカラー背景のカードで表示しなければならない
- **FR-018**: PR 達成種目を「NEW」バッジ付きで一覧表示しなければならない

**種目選択画面（ExercisePicker）**

- **FR-019**: 種目選択画面はフルスクリーンモーダルとして表示されなければならない
- **FR-020**: テキスト検索バーを持ち、入力に応じてリアルタイムで種目リストをフィルタリングしなければならない（カテゴリフィルターは含まない）

**種目履歴画面（ExerciseHistory）**

- **FR-021**: 種目履歴はフルスクリーンとして表示されなければならない（ボトムシートは使用しない）
- **FR-022**: 記録画面またはワークアウト詳細画面の種目名タップで種目履歴画面に遷移しなければならない

**統計画面**

- **FR-023**: 統計タブはプレースホルダー画面（「準備中」表示）とし、AI タブと同様の扱いとする

### 主要エンティティ

既存のデータモデル（`specs/001-workout-core-screens/data-model.md`）を変更しない。本フィーチャーはビジュアル層のみの変更。

---

## 成功基準 *(必須)*

### 測定可能な成果

- **SC-001**: ユーザーがアプリを起動したとき、タブバーの 5 つのアイテムと中央の + ボタンが切れることなく正しく表示される（目視確認で 100% 再現性）
- **SC-002**: iPhone・Android それぞれで各スクリーンを開いたとき、コンテンツがステータスバー・ノッチ・ホームインジケーターと重なるケースがゼロ
- **SC-003**: ワイヤーフレーム HTML の各スクリーンと並べて比較したとき、主要 UI 要素（レイアウト構造・カラー・タイポグラフィ階層）が 95% 以上一致している
- **SC-004**: 非エンジニアのユーザーがアプリを操作して「ワイヤーフレームのイメージ通りに動いている」と認識できる

---

## テスト方針

- ビジュアル層の変更に対してコンポーネント単体テストを実装する
- 各コンポーネントの重要な props・要素の存在・条件分岐のみを検証する（スナップショットテストは使用しない）
- 目視確認は SC-003 / SC-004 の基準で補完する

---

## 前提条件

- 既存の機能実装（データ取得・ストア・DB・ナビゲーション）は変更しない
- デザインシステムは `v1_light` 準拠（メインカラー #4D94FF、テキスト #475569）
- Expo Go で動作確認する（ネイティブモジュールの追加は不可）
- ワイヤーフレーム HTML が「正」。実装が乖離している場合は HTML に合わせる

---

## 実装時の注意事項（仕様補足）

| 項目 | 現状 | ワイヤーフレーム仕様 |
|------|------|---------------------|
| タブ数 | 4 タブ（AI なし） | 5 タブ（AI タブ追加） |
| +ボタン表示 | `overflow: hidden` で切れる可能性 | `overflow: visible` のコンテナ必要 |
| SafeArea | `pt-10` の固定値で代替 | `useSafeAreaInsets` で動的取得 |
| AI タブ | 未実装 | プレースホルダー（「準備中」）で OK |
| StreakCard | 実装済み | 塗りつぶし小円（完了: #4D94FF、休息: #e2e8f0）、28×28px、曜日ラベルなし |
| 統計タブ | 未実装 | プレースホルダー（「準備中」）で OK（AI タブと同様） |
| ExercisePicker | 実装済み | フルスクリーンモーダル + テキスト検索のみ（カテゴリフィルターなし） |
| ExerciseHistory | 実装済み | フルスクリーン表示（ボトムシートなし）、記録画面・詳細画面の種目名タップで遷移 |

---

## 確認事項

### セッション 2026-02-21

- Q: ExercisePicker・ExerciseHistory の受け入れシナリオは仕様に含めるか → A: 仕様書に受け入れシナリオ・FR を追加する
- Q: StreakCard の 7 日インジケーター形式は何を採用するか → A: 塗りつぶし小円（完了: #4D94FF、休息: #e2e8f0、曜日ラベルなし）
- Q: ビジュアル層のテスト戦略は何を採用するか → A: コンポーネント単体テスト（重要な props・要素の存在・条件分岐のみ検証、スナップショットなし）
- Q: 統計タブ画面のスコープをどう扱うか → A: プレースホルダー画面（「準備中」表示）のみ実装、AI タブと同様の扱い
- Q: ExercisePicker に検索・カテゴリフィルターは含めるか → A: テキスト検索のみ（カテゴリフィルターは含めない）

### セッション 2026-02-21（続き）

- Q: ExerciseHistory のエントリーポイントはどこか → A: 記録画面 + ワークアウト詳細画面の両方の種目名タップ
- Q: ワークアウト完了サマリーで PR が 0 件のとき「新記録達成」セクションをどう表示するか → A: セクション自体を非表示にする
- Q: ExercisePicker 検索で 0 件のときの空状態表示 → A: 「該当する種目が見つかりません」テキストを中央表示
- Q: ExerciseHistory の表示形式（ボトムシート vs フルスクリーン）→ A: フルスクリーンのみ（ボトムシートなし）、SafeArea は全フルスクリーン画面・モーダルに適用
- Q: 記録画面で種目が未追加の初期状態の表示 → A: 「+ 種目を追加」誘導テキスト＋ボタンを中央に表示
