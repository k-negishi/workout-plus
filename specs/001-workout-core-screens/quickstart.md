# Quickstart: ワークアウト記録コア画面

**Feature**: `001-workout-core-screens`

---

## 環境構築

```bash
# リポジトリクローン後
pnpm install
````

```bash
# モバイルアプリ起動
cd apps/mobile && npx expo start
```

Expo Go アプリ（iOS/Android）でQRコードを読み込んで動作確認。

---

## テスト

```bash
# 全テスト実行
pnpm --filter mobile test

# カバレッジ付き実行（閾値: 90%）
pnpm --filter mobile test:coverage

# ウォッチモード（開発中）
pnpm --filter mobile test -- --watch
```

---

## Lint / Format

```bash
# ESLint（strict-type-checked）
pnpm --filter mobile lint

# Prettier フォーマットチェック
pnpm --filter mobile format:check

# Prettier 自動修正
pnpm --filter mobile format
```

---

## CI（GitHub Actions）

`.github/workflows/ci.yml` が以下を自動実行:

1. `pnpm --filter mobile lint`
2. `pnpm --filter mobile format:check`
3. `pnpm --filter mobile test --coverage`
4. カバレッジ閾値 90% チェック

---

## ブランチ・コミット規約

```bash
# ブランチ名
feature/001-workout-core-screens

# コミットメッセージ 日本語で変更内容を簡潔に説明
- `add`: ユーザー価値が増える機能追加・仕様追加
- `fix`: バグ修正・不具合是正
- `docs`: ドキュメントのみ変更
- `refactor`: 振る舞いを変えない内部改善
- `test`: テスト追加・修正
- `chore`: 雑務的変更（設定、依存更新、軽微保守）
- `perf`: パフォーマンス改善
- `build`: ビルドシステムや依存解決の変更
- `ci`: CI/CD設定の変更
- `revert`: 既存コミットの取り消し
- `style`: フォーマットやlintのみ（意味的変更なし）
```

---

## 手動検証手順書

> **対象**: T066 (手動検証シナリオ) / T067 (Expo Go ローカル確認) / T068 (iPhone 実機確認)
>
> **合格基準**: 全シナリオの ✅ が揃うこと

---

### 事前準備

#### Expo Go ローカル確認（T067）

```bash
# 1. 依存パッケージをインストール
pnpm install

# 2. 開発サーバーを起動
cd apps/mobile
npx expo start

# または Turbo 経由
pnpm dev
```

ターミナルに QR コードが表示される。iOS シミュレーターで確認する場合:

```bash
npx expo start --ios
```

#### iPhone 実機確認（T068）

1. App Store から **Expo Go** をインストール
2. iPhone と PC を **同一 Wi-Fi** に接続
3. `npx expo start` を実行
4. ターミナルの QR コードを iPhone カメラで読み取り
5. Expo Go が自動起動してアプリが開く

> **⚠️ 注意**: 初回起動時は SQLite マイグレーションとシードデータの投入が走る。
> 数秒待ってホーム画面が表示されれば正常。

---

### シナリオ 1: 初回起動・ホーム画面

| # | 操作 | 期待結果 | 結果 |
|---|------|---------|------|
| 1-1 | アプリを起動する | ホーム画面が表示される | ☐ |
| 1-2 | 時刻に応じた挨拶を確認する | 「おはよう」「こんにちは」「こんばんは」のいずれか | ☐ |
| 1-3 | ワークアウトが 0 件の状態を確認する | EmptyState が表示される（「まだワークアウトがありません」） | ☐ |
| 1-4 | StreckCard の週間カレンダーを確認する | 今日の日付がハイライトされている | ☐ |
| 1-5 | QuickStats ウィジェットを確認する | 2×2 グリッドで統計が表示される | ☐ |

---

### シナリオ 2: ワークアウト記録（US1 コアフロー）

| # | 操作 | 期待結果 | 結果 |
|---|------|---------|------|
| 2-1 | 下部タブの「+」ボタンをタップ | 記録画面（RecordScreen）が開く | ☐ |
| 2-2 | タイマーバーを確認する | 「00:00」が表示されている | ☐ |
| 2-3 | 「種目を追加」ボタンをタップ | 種目選択モーダルが全画面で開く | ☐ |
| 2-4 | 検索バーに「ベンチ」と入力する | リストが「ベンチプレス」に絞り込まれる | ☐ |
| 2-5 | 「ベンチプレス」をタップして選択する | 記録画面に「ベンチプレス」ブロックが追加される | ☐ |
| 2-6 | タイマーの「▶」ボタンをタップ | タイマーがカウントアップ開始する | ☐ |
| 2-7 | セット 1 の重量欄に「60」、レップ欄に「10」を入力する | 推定 1RM が自動計算されて表示される | ☐ |
| 2-8 | 「+ セット追加」をタップする | セット 2 行が追加される | ☐ |
| 2-9 | セット 2 の重量「65」、レップ「8」を入力する | 推定 1RM が表示される | ☐ |
| 2-10 | 「完了」ボタンをタップする | サマリー画面（WorkoutSummaryScreen）に遷移する | ☐ |
| 2-11 | サマリー画面の内容を確認する | 総ボリューム・種目数・セット数・所要時間が表示される | ☐ |
| 2-12 | 「ホームに戻る」ボタンをタップする | ホーム画面に戻り、最近のワークアウトに今のセッションが表示される | ☐ |

---

### シナリオ 3: 種目管理（US5）

| # | 操作 | 期待結果 | 結果 |
|---|------|---------|------|
| 3-1 | 記録画面から種目選択モーダルを開く | モーダルが表示される | ☐ |
| 3-2 | 種目の ★ ボタンをタップする | アイコンが塗り状に変わる（お気に入り登録） | ☐ |
| 3-3 | モーダルを閉じて再度開く | お気に入り種目が「お気に入り」セクションの先頭に表示される | ☐ |
| 3-4 | カテゴリタブで「胸」を選択する | 胸の種目だけが絞り込まれる | ☐ |
| 3-5 | 「+ 種目を作成」または編集アイコンをタップする | カスタム種目フォームが表示される | ☐ |
| 3-6 | 種目名・部位・器具を入力して保存する | 「マイ種目」セクションに追加される | ☐ |

---

### シナリオ 4: 記録中の操作（US6）

| # | 操作 | 期待結果 | 結果 |
|---|------|---------|------|
| 4-1 | 記録中にタイマーの「⏸」をタップする | タイマーが一時停止する | ☐ |
| 4-2 | 「▶」をタップして再開する | タイマーが継続カウントする（停止前の時間から再開） | ☐ |
| 4-3 | セットの削除ボタン（🗑）をタップする | セットが削除され、番号が振り直される（1, 2, 3→1, 2） | ☐ |
| 4-4 | 種目メモ欄に文字を入力する | 入力内容が保持される | ☐ |
| 4-5 | 記録中にホームタブに切り替える | FloatingRecordBar が下部に表示される | ☐ |
| 4-6 | FloatingRecordBar をタップする | 記録画面に戻り、入力データが保持されている | ☐ |
| 4-7 | アプリをバックグラウンドにして 5 秒後に復帰する | データが消えておらず、タイマーが正しく経過時間を反映している | ☐ |
| 4-8 | 「×」ボタン（中止）をタップする | 破棄確認ダイアログが表示される | ☐ |
| 4-9 | 「続ける」をタップする | ダイアログが閉じ、記録画面に戻る | ☐ |
| 4-10 | 再度「×」→「破棄する」をタップする | 記録がキャンセルされ、ホーム画面に戻る | ☐ |

---

### シナリオ 5: 過去のワークアウト閲覧・編集（US2）

> **前提**: シナリオ 2 で 1 件以上のワークアウトが記録済みであること

| # | 操作 | 期待結果 | 結果 |
|---|------|---------|------|
| 5-1 | ホームのワークアウトカードをタップする | 詳細画面（WorkoutDetailScreen）が表示される | ☐ |
| 5-2 | 種目・セット・ボリューム・時間が表示されることを確認する | 記録時の内容と一致している | ☐ |
| 5-3 | 「編集」ボタンをタップする | 編集画面（WorkoutEditScreen）が開く | ☐ |
| 5-4 | セット 1 の重量を変更する | 入力欄で値を変更できる | ☐ |
| 5-5 | 「保存」ボタンをタップする | 詳細画面に戻り、変更が反映されている | ☐ |
| 5-6 | 再度「編集」を開いて変更せず「キャンセル」する | 詳細画面に戻る（変更なし） | ☐ |
| 5-7 | 「編集」を開いて値を変更してから「キャンセル」する | 破棄確認ダイアログが表示される | ☐ |
| 5-8 | 「変更を破棄」を選ぶ | 詳細画面に戻り、変更前の値に戻っている | ☐ |
| 5-9 | 詳細画面の「削除」ボタンをタップする | 削除確認ダイアログが表示される（「この操作は取り消せません」） | ☐ |
| 5-10 | 「削除する」をタップする | ホーム画面に戻り、削除したワークアウトが一覧から消えている | ☐ |

---

### シナリオ 6: カレンダー（US3）

| # | 操作 | 期待結果 | 結果 |
|---|------|---------|------|
| 6-1 | 下部タブの「カレンダー」をタップする | カレンダー画面が表示される | ☐ |
| 6-2 | トレーニング日（記録済みの日付）を確認する | 青いドットマーカーが表示されている | ☐ |
| 6-3 | トレーニング日の日付をタップする | 日次サマリーが表示される（種目数・ボリューム等） | ☐ |
| 6-4 | トレーニングがない日をタップする | 「この日はトレーニングなし」と表示される | ☐ |
| 6-5 | 未来の日付をタップする | タップが無効（何も起きない） | ☐ |
| 6-6 | 「＜」「＞」で月を切り替える | 前後の月に遷移する | ☐ |
| 6-7 | サマリーから詳細画面に遷移できることを確認する | WorkoutDetailScreen に遷移する | ☐ |

---

### シナリオ 7: 種目履歴（US4）

> **前提**: 同一種目で複数回ワークアウトが記録済みであること

| # | 操作 | 期待結果 | 結果 |
|---|------|---------|------|
| 7-1 | 記録画面の種目名をタップする | 種目履歴画面（ExerciseHistoryFullScreen）が開く | ☐ |
| 7-2 | 統計サマリーカードを確認する | 最大重量・最大ボリューム・総トレ回数が表示される | ☐ |
| 7-3 | 重量推移チャートを確認する | 棒グラフが表示される（青色） | ☐ |
| 7-4 | PR 履歴セクションを確認する | 最大重量・最大ボリューム・最大レップ数の PR と達成日が表示される | ☐ |
| 7-5 | 全履歴リストを確認する | 日付降順で過去のセッションが表示される | ☐ |

---

### シナリオ 8: 前回記録の表示（US1 詳細）

> **前提**: 同一種目で 2 回以上ワークアウトが記録済みであること

| # | 操作 | 期待結果 | 結果 |
|---|------|---------|------|
| 8-1 | 以前に記録した種目を含む新規ワークアウトを開始する | 記録画面を開く | ☐ |
| 8-2 | 以前記録した種目を追加する | 各セット行の上に前回記録（重量・レップ数）がグレーで表示される | ☐ |
| 8-3 | 前回記録の「コピー」ボタンをタップする | 前回の値がセットにコピーされる | ☐ |
| 8-4 | 2 回目のワークアウト完了後にサマリーを確認する | PR を更新した場合「NEW」バッジが表示される | ☐ |

---

### シナリオ 9: エッジケース

| # | 操作 | 期待結果 | 結果 |
|---|------|---------|------|
| 9-1 | 種目を 0 件の状態で「完了」ボタンを確認する | 「完了」ボタンが無効（グレー表示）になっている | ☐ |
| 9-2 | 重量・レップ数をともに空欄のままセットを追加して完了する | null セットが除外されてサマリーに反映される | ☐ |
| 9-3 | 種目選択モーダルで存在しない名前を検索する | 「種目が見つかりません」EmptyState が表示される | ☐ |
| 9-4 | アプリを完全に終了して再起動する（記録中の状態） | 記録中データが復元される（FloatingRecordBar が表示される） | ☐ |

---

### 検証結果サマリー

| シナリオ | 項目数 | 合格数 | 状態 |
|---------|--------|--------|------|
| 1. 初回起動・ホーム画面 | 5 | | ☐ |
| 2. ワークアウト記録（US1） | 12 | | ☐ |
| 3. 種目管理（US5） | 6 | | ☐ |
| 4. 記録中の操作（US6） | 10 | | ☐ |
| 5. 過去閲覧・編集（US2） | 10 | | ☐ |
| 6. カレンダー（US3） | 7 | | ☐ |
| 7. 種目履歴（US4） | 5 | | ☐ |
| 8. 前回記録表示（US1詳細） | 4 | | ☐ |
| 9. エッジケース | 4 | | ☐ |
| **合計** | **63** | | |

**合格基準**: 全 63 項目が ✅ であること

---

### 不具合発見時の報告フォーマット

```
## 不具合報告

- **シナリオ**: 2-7
- **手順**: セット 1 の重量欄に「60」入力後、レップ欄に「10」を入力
- **期待結果**: 推定 1RM が自動表示される
- **実際の結果**: 推定 1RM が表示されない
- **環境**: Expo Go / iPhone 15 Pro / iOS 17.4
- **再現性**: 毎回
```

---

## 実機確認チェックリスト（T068 専用）

iPhone での追加確認項目：

| # | 確認項目 | 結果 |
|---|---------|------|
| R-1 | セーフエリア（ノッチ・ダイナミックアイランド）が正しく適用されている | ☐ |
| R-2 | キーボード表示時にセット入力欄が隠れない | ☐ |
| R-3 | スクロールが滑らか（60fps）に動作する | ☐ |
| R-4 | タイマーがバックグラウンド移行後も正確に動作する | ☐ |
| R-5 | フォントが Noto Sans JP で表示される | ☐ |
| R-6 | ダークモード切り替え時のレイアウト崩れがない | ☐ |
| R-7 | 文字サイズ変更（アクセシビリティ設定）でレイアウト崩れがない | ☐ |
