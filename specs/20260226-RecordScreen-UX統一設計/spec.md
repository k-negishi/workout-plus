# Feature Specification: RecordScreen UX 統一設計

**Feature Branch**: `20260226-RecordScreen-UX統一設計`
**Created**: 2026-02-26
**Status**: Draft

## 概要

ワークアウト記録画面（RecordScreen）の UX を整理する。
現在「終了」と表記されているボタンを「完了」に変更し、3つのユースケース（新規登録・再開・編集）で同一画面を使いながら、各モードの挙動を明確に定義する。

## 前提条件・仮定

- ワークアウトには 2 つの状態（`recording` / `completed`）がある
- `recording` 状態のワークアウトは中断しても再開できる（継続登録）
- 「即時保存」はユーザー体験としての概念であり、今回のスコープではセッション完了時の保存フローは変更しない
- 「完了」ボタンを押さずに離脱した場合、データは失われない（再開可能）

## 有効データの定義

### 有効セット

次の条件を **すべて** 満たすセットを「有効セット」とする。

- 重量（kg）が入力されている（null でない）
- レップ数が入力されている（null でない）
- レップ数が 1 以上（0 は「未実施」扱いのため無効）

### 有効種目

有効セットが 1 件以上ある種目を「有効種目」とする。
以下はいずれも「有効でない種目」として完了時に削除する:

- セットが 1 件もない種目
- セットはあるが全て無効セットの種目

### 完了時のクリーンアップルール

```
1. 各種目の無効セットを削除
2. 有効セットが 0 件になった種目を削除
3. 有効種目が 1 件以上 → ワークアウトを保存して完了
   有効種目が 0 件   → ワークアウトを破棄して前画面へ戻る（Toast通知）
```

---

## User Scenarios & Testing

### User Story 1 - 新規ワークアウトを完了してサマリーを見る (Priority: P1)

ユーザーが今日のワークアウトを記録し、「完了」ボタンを押してセッションを終わらせると、ワークアウトのサマリー画面が表示される。ユーザーはボタンラベルから「これを押せばワークアウトが完成する」と直感的に理解できる。

**Why this priority**: 最も頻繁に使われる基本フロー。「完了」への変更はすべてのユーザーが毎回体験するため影響が最大。

**Independent Test**: 新規ワークアウトを作成してセットを入力し、「完了」ボタンをタップした際にサマリー画面へ遷移することで完結して検証できる。

**Acceptance Scenarios**:

1. **Given** ワークアウト記録中（status=recording）で 1 件以上の有効セットがある、**When** 「完了」ボタンをタップする、**Then** ワークアウトサマリー画面へ遷移する
2. **Given** ワークアウト記録中で有効種目が 0 件（全セットが未入力または不完全）、**When** 「完了」ボタンをタップする、**Then** ワークアウトは破棄され、Toast「記録がないため破棄しました」を表示して前画面へ戻る（サマリーは表示しない）
3. **Given** 記録画面を開いている、**When** 画面を見る、**Then** ボタンラベルは「完了」と表示される（「終了」ではない）
4. **Given** 種目 A は有効セットあり・種目 B はセットなし（または全セット無効）の状態で「完了」をタップする、**Then** 種目 B のみ削除され、種目 A の有効セットだけが保存されてサマリーへ遷移する

---

### User Story 2 - 中断したワークアウトを再開して完了する (Priority: P2)

ユーザーが記録中に別の画面に移動し、後で RecordScreen に戻ってきたとき、タイマーが継続しており「完了」ボタンでセッションを終わらせてサマリーを表示できる。

**Why this priority**: 継続登録は既存機能。モード判定ロジックの変更が再開時の挙動に影響しないことの確認が必要。

**Independent Test**: 記録中に別タブへ移動し、記録タブに戻った際に記録が継続していること、「完了」ボタンでサマリーへ遷移することで検証できる。

**Acceptance Scenarios**:

1. **Given** ワークアウト記録中（status=recording）で別の画面に移動した後 RecordScreen に戻る、**When** 画面を確認する、**Then** タイマーが継続しており入力済みのセットが表示されている
2. **Given** 再開した RecordScreen で有効セットがある、**When** 「完了」ボタンをタップする、**Then** サマリー画面へ遷移する

---

### User Story 3 - 過去の完了済みワークアウトを編集する (Priority: P3)

ユーザーが過去の完了済みワークアウトを開いて内容を修正できる。編集は即時反映され、「完了」ボタンや確認ダイアログを経ることなく、「戻る」操作で編集を終える。

**Why this priority**: 編集モードはタイマーと完了ボタンが不要という点が新規/再開と異なる。誤ってタイマーが表示されたり「完了」ボタンが出たりしないことの保証が必要。

**Independent Test**: 完了済みワークアウトを開いたとき、タイマーと「完了」ボタンが表示されないことで独立して検証できる。

**Acceptance Scenarios**:

1. **Given** 完了済みワークアウト（status=completed）の編集画面を開く、**When** 画面を確認する、**Then** タイマーは表示されない
2. **Given** 完了済みワークアウトの編集画面を開く、**When** 画面を確認する、**Then** 「完了」ボタンは表示されない
3. **Given** 編集画面でセットの値を変更する、**When** 変更後に「戻る」をタップする、**Then** 変更が保持された状態で前の画面に戻る

---

### Edge Cases

- 有効種目が 0 件で「完了」をタップした場合、サマリーには遷移せず Toast を表示して前画面へ戻る
- 種目はあるが全セットが不完全（kg または reps の片方 null、または reps=0）の場合も「有効種目 0 件」として同様に処理する
- `status` の判定タイミングが画面表示前か後かで、一瞬タイマーが表示される可能性がある → 画面マウント時に即時判定すること
- 編集モードで「戻る」後も、元の completed 状態が維持されていること

---

## Requirements

### Functional Requirements

- **FR-001**: 記録中（status=recording）の画面では、ボタンラベルを「完了」と表示しなければならない
- **FR-002**: 記録中（status=recording）の画面では、タイマーを表示・動作させなければならない
- **FR-003**: 「完了」タップ時、有効種目が 1 件以上あればサマリー画面へ遷移しなければならない
- **FR-004**: 「完了」タップ時、有効種目が 0 件であればワークアウトを破棄し、Toast を表示して前画面へ戻らなければならない（サマリー画面へは遷移しない）
- **FR-005**: 完了処理では、無効セット（kg/reps のいずれかが null、または reps=0）を削除しなければならない
- **FR-006**: 完了処理では、有効セットが 0 件になった種目を削除しなければならない（セットが 1 件もない種目も含む）
- **FR-007**: 完了済み（status=completed）の画面では、タイマーを表示してはならない
- **FR-008**: 完了済み（status=completed）の画面では、「完了」ボタンを表示してはならない
- **FR-009**: 完了済みワークアウトの編集内容は、「戻る」タップ時に保持されていなければならない
- **FR-010**: 記録中に「戻る」で離脱した場合、ワークアウトは recording 状態のまま保持され、再開できなければならない

### Key Entities

- **ワークアウト**: ステータス（recording / completed）によって RecordScreen の表示モードが決まる
- **モード**: recording モード（新規登録・再開）と completed モード（編集）の 2 種類。画面レイアウトは共通
- **有効セット**: weight が入力済み かつ reps が入力済み かつ reps ≥ 1 のセット
- **有効種目**: 有効セットが 1 件以上ある種目

---

## Success Criteria

### Measurable Outcomes

- **SC-001**: すべてのユーザーが記録完了ボタンのラベルを「完了」として認識できる（ラベル変更後の視認テストで確認可）
- **SC-002**: 新規登録・再開・編集のいずれのケースでも、「完了」ボタンの有無とタイマーの表示状態が仕様通りになっている（全ケースのスモークテストで確認可）
- **SC-003**: 編集モードで誤って「完了」ボタンが表示されることがなくなる（completed ワークアウト 5 件を開いて確認可）
- **SC-004**: 記録中に離脱して再開した場合、入力済みデータが失われない（継続登録フローのエンドツーエンドテストで確認可）
